{
	"schema": "iglu:com.snowplowanalytics.snowplow/javascript_script_config/jsonschema/1-0-0",
	"data": {
		"vendor": "com.snowplowanalytics.snowplow",
		"name": "javascript_script_config",
		"enabled": true,
		"parameters": {
			"script": "ZnVuY3Rpb24gcHJvY2VzcyhldmVudCkgewogIHZhciBkZXRlY3RvciA9IG5ldyBEZXZpY2VEZXRlY3RvcjsKICB2YXIgdXNlckFnZW50ID0gZXZlbnQudXNlcmFnZW50KCk7CiAgdmFyIGRldGVjdGVkX3VzZXJhZ2VudCA9IGRldGVjdG9yLmRldGVjdCh1c2VyQWdlbnQpOwogIHJldHVybiBbIHsgc2NoZW1hOiAiaWdsdTpjb20uaG9tZXRvZ28vZGVyaXZlZC11c2VyYWdlbnQvanNvbnNjaGVtYS8xLTAtMCIsCiAgICBkYXRhOiAgeyB1c2VyYWdlbnQ6IGRldGVjdGVkX3VzZXJhZ2VudCB9IH0gXTsKfQoKZnVuY3Rpb24gZ2V0RmlsZUludG9KU09OKHBhdGgpIHsKICB2YXIgcmVhZGVyID0gbmV3IGphdmEuaW8uRmlsZVJlYWRlcihwYXRoKTsKICB2YXIgc2IgPSBuZXcgamF2YS5sYW5nLlN0cmluZ0J1aWxkZXI7CiAgd2hpbGUgKChjID0gcmVhZGVyLnJlYWQoKSkgIT0gLTEpIHsgCiAgICBzYi5hcHBlbmQoU3RyaW5nLmZyb21DaGFyQ29kZShjKSk7CiAgfTsKCiAgaWYgKHJlYWRlciAhPSBudWxsKSB7CiAgICByZWFkZXIuY2xvc2UoKTsKICB9OwoKICByZXR1cm4gSlNPTi5wYXJzZShzYik7Cn0KCnZhciBtZXJnZUpTT04gPSBmdW5jdGlvbigpIHsKICB2YXIgcmVzdWx0ID0ge307CiAgZm9yICh2YXIgaT0wOyBpPGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgZm9yKHZhciBrZXkgaW4gYXJndW1lbnRzW2ldKSByZXN1bHRba2V5XSA9IGFyZ3VtZW50c1tpXVtrZXldOwogIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGdldEJhc2VSZWdFeHAoc3RyKSB7CiAgc3RyID0gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cCgnLycsICdnJyksICdcXC8nKTsKICBzdHIgPSBzdHIucmVwbGFjZShuZXcgUmVnRXhwKCdcXCtcXCsnLCAnZycpLCAnKycpOwogIHN0ciA9ICcoPzpefFteQS1aMC05XC1fXXxbXkEtWjAtOVwtXV98c3ByZC0pKD86JyArIHN0ciArICcpJzsKICByZXR1cm4gbmV3IFJlZ0V4cChzdHIsICdpJyk7Cn0KCmZ1bmN0aW9uIERldmljZURldGVjdG9yKG9wdGlvbnMpIHsKICB0aGlzLmFwcF9jb2xsZWN0aW9uID0gW107CiAgdGhpcy5icm93c2VyX2NvbGxlY3Rpb24gPSBbXTsKICB0aGlzLm9zX2NvbGxlY3Rpb24gPSBbXTsKICB0aGlzLm9zX3N5c3RlbXMgPSBbXTsKICB0aGlzLm9zX2ZhbWlsaWVzID0gW107CiAgdGhpcy5vc19jb2xsZWN0aW9uID0gW107CiAgdGhpcy5kZXZpY2VfY29sbGVjdGlvbiA9IFtdOwoKICB0aGlzLmluaXQoKTsKfQoKRGV2aWNlRGV0ZWN0b3IucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIGRpciA9ICcvc25vd3Bsb3cvY29uZmlnL2VucmljaG1lbnRzL2RhdGEnOwogIHRoaXMuYXBwX2NvbGxlY3Rpb24gPSBnZXRGaWxlSW50b0pTT04oZGlyICsgJy9tb2JpbGVfYXBwcy5qc29uJyk7CiAgdGhpcy5icm93c2VyX2NvbGxlY3Rpb24gPSBnZXRGaWxlSW50b0pTT04oZGlyICsgJy9icm93c2Vycy5qc29uJyk7CiAgdGhpcy5vc19jb2xsZWN0aW9uID0gZ2V0RmlsZUludG9KU09OKGRpciArICcvb3NzLmpzb24nKTsKICB0aGlzLm9zX2ZhbWlsaWVzID0gZ2V0RmlsZUludG9KU09OKGRpciArICcvb3NfZmFtaWxpZXMuanNvbicpOwogIHRoaXMub3Nfc3lzdGVtcyA9IGdldEZpbGVJbnRvSlNPTihkaXIgKyAnL29zX3N5c3RlbXMuanNvbicpOwogIHRoaXMuZGV2aWNlX2NvbGxlY3Rpb24gPSBtZXJnZUpTT04oZ2V0RmlsZUludG9KU09OKGRpciArICcvZGV2aWNlcy9jYW1lcmFzLmpzb24nKSwgZ2V0RmlsZUludG9KU09OKGRpciArICcvZGV2aWNlcy9jYXJfYnJvd3NlcnMuanNvbicpLCBnZXRGaWxlSW50b0pTT04oZGlyICsgJy9kZXZpY2VzL2NvbnNvbGVzLmpzb24nKSwgZ2V0RmlsZUludG9KU09OKGRpciArICcvZGV2aWNlcy9tZWRpYV9wbGF5ZXJzLmpzb24nKSwgZ2V0RmlsZUludG9KU09OKGRpciArICcvZGV2aWNlcy9tb2JpbGVzLmpzb24nKSwgZ2V0RmlsZUludG9KU09OKGRpciArICcvZGV2aWNlcy90ZWxldmlzaW9ucy5qc29uJykpOwp9OwoKRGV2aWNlRGV0ZWN0b3IucHJvdG90eXBlLmZpeFN0cmluZ05hbWUgPSBmdW5jdGlvbiAocmVzdWx0KSB7CiAgcmV0dXJuIHJlc3VsdC5yZXBsYWNlKG5ldyBSZWdFeHAoJ18nLCAnZycpLCAnICcpLnJlcGxhY2UoLyBURCQvaSwgJycpOwp9OwoKRGV2aWNlRGV0ZWN0b3IucHJvdG90eXBlLmZpeFN0cmluZ1ZlcnNpb24gPSBmdW5jdGlvbiAocmVzdWx0KSB7CiAgcmV0dXJuIHJlc3VsdC5yZXBsYWNlKG5ldyBSZWdFeHAoJ18nLCAnZycpLCAnLicpLnRyaW0oKTsKfTsKCkRldmljZURldGVjdG9yLnByb3RvdHlwZS5idWlsZFZlcnNpb24gPSBmdW5jdGlvbiAodmVyc2lvbiwgbWF0Y2hlcykgewogIHJldHVybiB0aGlzLmZpeFN0cmluZ1ZlcnNpb24odGhpcy5idWlsZEJ5TWF0Y2godmVyc2lvbiwgbWF0Y2hlcykpOwp9OwoKRGV2aWNlRGV0ZWN0b3IucHJvdG90eXBlLmJ1aWxkTW9kZWwgPSBmdW5jdGlvbiAobW9kZWwsIG1hdGNoZXMpIHsKICBtb2RlbCA9IHRoaXMuZml4U3RyaW5nTmFtZSh0aGlzLmJ1aWxkQnlNYXRjaChtb2RlbCwgbWF0Y2hlcykpOwogIHJldHVybiAobW9kZWwgPT09ICdCdWlsZCcpID8gbnVsbCA6IG1vZGVsOwp9OwoKRGV2aWNlRGV0ZWN0b3IucHJvdG90eXBlLmJ1aWxkQnlNYXRjaCA9IGZ1bmN0aW9uIChpdGVtLCBtYXRjaGVzKSB7CiAgaXRlbSA9IGl0ZW0udG9TdHJpbmcoKTsKICBpZiAoaXRlbS5pbmRleE9mKCckJykgIT09IC0xKSB7CiAgICBmb3IgKHZhciBuYiA9IDE7IG5iIDw9IDM7IG5iKyspIHsKICAgICAgaWYgKGl0ZW0uaW5kZXhPZignJCcgKyBuYikgPT09IC0xKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH07CiAgICAgIHZhciByZXBsYWNlID0gKG1hdGNoZXNbbmJdICE9PSB1bmRlZmluZWQpID8gbWF0Y2hlc1tuYl0gOiAnJzsKICAgICAgaXRlbSA9IGl0ZW0ucmVwbGFjZSgnJCcgKyBuYiwgcmVwbGFjZSk7CiAgICB9OwogIH07CiAgcmV0dXJuIGl0ZW07Cn07CgpEZXZpY2VEZXRlY3Rvci5wcm90b3R5cGUuZmluZERldmljZSA9IGZ1bmN0aW9uICh1c2VyQWdlbnQpIHsKCgogIGZvciAodmFyIGJyYW5kIGluIHRoaXMuZGV2aWNlX2NvbGxlY3Rpb24pIHsKCiAgICB2YXIgbWF0Y2ggPSBnZXRCYXNlUmVnRXhwKHRoaXMuZGV2aWNlX2NvbGxlY3Rpb25bYnJhbmRdWydyZWdleCddKS5leGVjKHVzZXJBZ2VudCk7CiAgICB2YXIgZGV2aWNlVHlwZSA9IHRoaXMuZGV2aWNlX2NvbGxlY3Rpb25bYnJhbmRdWydkZXZpY2UnXTsKICAgIHZhciBtb2RlbCA9ICcnOwoKICAgIGlmIChtYXRjaCkgewogICAgICBpZiAodGhpcy5kZXZpY2VfY29sbGVjdGlvblticmFuZF1bJ21vZGVscyddICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB2YXIgbW9kZWxzID0gdGhpcy5kZXZpY2VfY29sbGVjdGlvblticmFuZF1bJ21vZGVscyddOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbW9kZWxzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgdmFyIGRhdGEgPSBtb2RlbHNbaV07CiAgICAgICAgICB2YXIgbW9kZWxNYXRjaCA9IGdldEJhc2VSZWdFeHAoZGF0YS5yZWdleCkuZXhlYyh1c2VyQWdlbnQpOwogICAgICAgICAgaWYgKG1vZGVsTWF0Y2gpIHsKICAgICAgICAgICAgbW9kZWwgPSB0aGlzLmJ1aWxkTW9kZWwoZGF0YS5tb2RlbCwgbW9kZWxNYXRjaCk7CiAgICAgICAgICAgIGlmIChkYXRhLmRldmljZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgZGV2aWNlVHlwZSA9IGRhdGEuZGV2aWNlOwogICAgICAgICAgICB9OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmRldmljZV9jb2xsZWN0aW9uW2JyYW5kXVsnbW9kZWwnXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbW9kZWwgPSB0aGlzLmJ1aWxkTW9kZWwodGhpcy5kZXZpY2VfY29sbGVjdGlvblticmFuZF1bJ21vZGVsJ10sIG1hdGNoKTsKICAgICAgfTsKICAgICAgcmV0dXJuIHsKICAgICAgICBicmFuZDogU3RyaW5nKGJyYW5kKS50cmltKCksCiAgICAgICAgbW9kZWw6IFN0cmluZyhtb2RlbCkudHJpbSgpLAogICAgICAgIHR5cGU6IGRldmljZVR5cGUKICAgICAgfTsKICAgIH07CiAgfTsKICByZXR1cm4gbnVsbDsKfTsKCkRldmljZURldGVjdG9yLnByb3RvdHlwZS5maW5kQXBwID0gZnVuY3Rpb24gKHVzZXJBZ2VudCkgewogIGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5hcHBfY29sbGVjdGlvbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgIHZhciBpdGVtID0gdGhpcy5hcHBfY29sbGVjdGlvbltpXTsKICAgIHZhciByZWdleCA9IGdldEJhc2VSZWdFeHAoaXRlbS5yZWdleCk7CiAgICB2YXIgbWF0Y2g7CiAgICBpZiAobWF0Y2ggPSByZWdleC5leGVjKHVzZXJBZ2VudCkpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiB0aGlzLmJ1aWxkQnlNYXRjaChpdGVtLm5hbWUsIG1hdGNoKSwKICAgICAgICB2ZXJzaW9uOiB0aGlzLmJ1aWxkVmVyc2lvbihpdGVtLnZlcnNpb24sIG1hdGNoKSwKICAgICAgICB0eXBlOiAnbW9iaWxlIGFwcCcKICAgICAgfTsKICAgIH07CiAgfTsKICByZXR1cm4ge307Cn07CgoKRGV2aWNlRGV0ZWN0b3IucHJvdG90eXBlLmZpbmRCcm93c2VyID0gZnVuY3Rpb24gKHVzZXJfYWdlbnQpIHsKICBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMuYnJvd3Nlcl9jb2xsZWN0aW9uLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgdmFyIGl0ZW0gPSB0aGlzLmJyb3dzZXJfY29sbGVjdGlvbltpXTsKICAgIHZhciByZWdleCA9IGdldEJhc2VSZWdFeHAoaXRlbS5yZWdleCk7CiAgICB2YXIgbWF0Y2g7CiAgICBpZiAobWF0Y2ggPSByZWdleC5leGVjKHVzZXJfYWdlbnQpKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogdGhpcy5idWlsZEJ5TWF0Y2goaXRlbS5uYW1lLCBtYXRjaCksCiAgICAgICAgdmVyc2lvbjogdGhpcy5idWlsZFZlcnNpb24oaXRlbS52ZXJzaW9uLCBtYXRjaCksCiAgICAgICAgdHlwZTogJ2Jyb3dzZXInCiAgICAgIH07CiAgICB9OwogIH07CiAgcmV0dXJuIG51bGw7Cn07CgoKLyoqCiAqIEBwYXJhbSB1c2VyQWdlbnQKICogQHJldHVybiB7e25hbWU6IHN0cmluZywgdmVyc2lvbjogc3RyaW5nLCBwbGF0Zm9ybTogc3RyaW5nLCBzaG9ydF9uYW1lOiBzdHJpbmd9fXxudWxsCiAqLwpEZXZpY2VEZXRlY3Rvci5wcm90b3R5cGUuZmluZE9zID0gZnVuY3Rpb24gKHVzZXJBZ2VudCkgewogIGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5vc19jb2xsZWN0aW9uLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgdmFyIGl0ZW0gPSB0aGlzLm9zX2NvbGxlY3Rpb25baV07CiAgICB2YXIgcmVnZXggPSBnZXRCYXNlUmVnRXhwKGl0ZW0ucmVnZXgpOwogICAgdmFyIG1hdGNoOwogICAgaWYgKG1hdGNoID0gcmVnZXguZXhlYyh1c2VyQWdlbnQpKSB7CgogICAgICB2YXIgbmFtZSA9IHRoaXMuYnVpbGRCeU1hdGNoKGl0ZW0ubmFtZSwgbWF0Y2gpOwogICAgICB2YXIgc2hvcnQgPSAnVU5LJzsKCiAgICAgIGZvcih2YXIga2V5IGluIHRoaXMub3Nfc3lzdGVtcyl7CiAgICAgICAgaWYgKFN0cmluZyhuYW1lKS50b0xvd2VyQ2FzZSgpID09PSBTdHJpbmcodGhpcy5vc19zeXN0ZW1zW2tleV0pLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgICAgIG5hbWUgPSB0aGlzLm9zX3N5c3RlbXNba2V5XTsKICAgICAgICAgIHNob3J0ID0ga2V5OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfTsKICAgICAgfTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICB2ZXJzaW9uOiB0aGlzLmJ1aWxkVmVyc2lvbihpdGVtLnZlcnNpb24sIG1hdGNoKSwKICAgICAgICBwbGF0Zm9ybTogdGhpcy5maW5kUGxhdGZvcm0odXNlckFnZW50KSwKICAgICAgICBzaG9ydF9uYW1lOiBzaG9ydAogICAgICB9OwogICAgfTsKICB9OwogIHJldHVybiBudWxsOwp9OwoKLyoqCiAqIEBwYXJhbSB1c2VyQWdlbnQKICogQHJldHVybiB7Kn0KICovCkRldmljZURldGVjdG9yLnByb3RvdHlwZS5maW5kUGxhdGZvcm0gPSBmdW5jdGlvbiAodXNlckFnZW50KSB7CiAgaWYgKC9hcm0vaS50ZXN0KHVzZXJBZ2VudCkpIHsKICAgIHJldHVybiAnQVJNJzsKICB9IGVsc2UgaWYgKC9XT1c2NHx4NjR8d2luNjR8YW1kNjR8eDg2XzY0L2kudGVzdCh1c2VyQWdlbnQpKSB7CiAgICByZXR1cm4gJ3g2NCc7CiAgfSBlbHNlIGlmICgvaVswLTldODZ8aTg2cGMvaS50ZXN0KHVzZXJBZ2VudCkpIHsKICAgIHJldHVybiAneDg2JzsKICB9OwogIHJldHVybiAnJzsKfTsKCkRldmljZURldGVjdG9yLnByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbiAodXNlcl9hZ2VudCkgewogIHZhciBvc0RhdGEgPSB0aGlzLmZpbmRPcyh1c2VyX2FnZW50KTsKICB2YXIgY2xpZW50RGF0YSA9IHRoaXMuZmluZEFwcCh1c2VyX2FnZW50KTsKICB2YXIgZGV2aWNlRGF0YSA9IHRoaXMuZmluZERldmljZSh1c2VyX2FnZW50KTsKICB2YXIgcmV0ID0gewogICAgb3M6IG9zRGF0YQogIH07CgogIGlmIChjbGllbnREYXRhLm5hbWUgPT09IHVuZGVmaW5lZCkgewogICAgY2xpZW50RGF0YSA9IHRoaXMuZmluZEJyb3dzZXIodXNlcl9hZ2VudCk7CiAgICByZXQuY2xpZW50ID0gewogICAgICBuYW1lOiBjbGllbnREYXRhLm5hbWUsCiAgICAgIHZlcnNpb246IGNsaWVudERhdGEudmVyc2lvbiwKICAgICAgdHlwZTogY2xpZW50RGF0YS50eXBlCiAgICB9OwogIH07CiAgaWYgKGRldmljZURhdGEpIHsKICAgIHJldC5kZXZpY2UgPSB7CiAgICAgIGJyYW5kOiBkZXZpY2VEYXRhLmJyYW5kLAogICAgICBtb2RlbDogZGV2aWNlRGF0YS5tb2RlbCwKICAgICAgdHlwZTogZGV2aWNlRGF0YS50eXBlLAogICAgfTsKICB9OwoKICByZXR1cm4gcmV0Owp9OwoK"
		}
	}
}
